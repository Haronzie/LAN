<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - File Sharing</title>
  <!-- Optional: FontAwesome for Icons -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LID5Zgg1OTBZfT2U5bSUsRKfl6KviY5tnQz2I4zkkk7E8o7h4zEY3YBA=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <link
    href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700"
    rel="stylesheet"
  />
  <style>
    /* --------------------------------
       COLOR & STYLE VARIABLES
    -------------------------------- */
    :root {
      --primary-color: #1877f2;
      --secondary-color: #165ecc;
      --error-color: #ff4d4d;
      --success-color: #4dff88;
      --card-bg: rgba(255, 255, 255, 0.08);
      --sidebar-bg: #1f2123; /* Dark sidebar */
      --header-bg: #18191b;  /* Dark header */
      --text-color: #ffffff;
      --hover-bg: rgba(255, 255, 255, 0.1);
    }

    /* Global Reset */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
  background: url("images/diwata.jpg") no-repeat center top;
  background-size: 100% 100%; /* Forces the image to fill width & height */
  background-attachment: fixed; /* Optional: keeps the image fixed in place */
  color: var(--text-color);
  min-height: 100vh;
  display: flex;
}



    /* --------------------------------
       SIDEBAR
    -------------------------------- */
    .sidebar {
      width: 220px;
      background: var(--sidebar-bg);
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      overflow-y: auto;
      padding: 1rem 0;
      box-shadow: 2px 0 5px rgba(0,0,0,0.5);
      z-index: 11;
    }
    .sidebar ul {
      list-style: none;
      margin-top: 1rem;
    }
    .sidebar li {
      margin-bottom: 1rem;
    }
    .sidebar a {
      color: var(--text-color);
      text-decoration: none;
      font-size: 1rem;
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      transition: background 0.3s ease;
      border-left: 3px solid transparent;
    }
    .sidebar a i {
      margin-right: 0.75rem;
      font-size: 1.1rem;
    }
    .sidebar a:hover,
    .sidebar a.active {
      background: var(--hover-bg);
      border-left: 3px solid var(--primary-color);
    }

    /* --------------------------------
       HEADER
    -------------------------------- */
    header {
      background: var(--header-bg);
      padding: 1rem 2rem;
      font-size: 1.5rem;
      font-weight: 500;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      position: fixed;
      top: 0;
      left: 220px;
      right: 0;
      z-index: 10;
      display: flex;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.5);
    }
    header .header-title {
      flex: 1;
      text-align: center;
    }

    /* --------------------------------
       MAIN CONTENT
    -------------------------------- */
    main {
      margin-left: 220px;
      margin-top: 70px;
      width: calc(100% - 220px);
      padding: 2rem 1rem;
      transition: margin-left 0.3s ease;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Grid Layout for Dashboard Cards */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
    }

    /* --------------------------------
       CARDS
    -------------------------------- */
    .card {
      background: var(--card-bg);
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      transition: transform 0.3s ease;
      animation: fadeIn 0.5s ease-in;
    }
    .card:hover {
      transform: translateY(-3px);
    }
    .card h3 {
      margin-bottom: 1rem;
      font-size: 1.2rem;
      font-weight: 500;
    }

    /* Form Elements */
    .card form {
      display: flex;
      flex-direction: column;
    }
    .card input[type="text"],
    .card input[type="password"],
    .card input[type="file"] {
      padding: 0.75rem;
      margin-bottom: 1rem;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
      color: #333;
    }
    .card button {
      padding: 0.75rem;
      background: var(--primary-color);
      border: none;
      color: #fff;
      font-size: 1rem;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.3s ease;
    }
    .card button:hover {
      background: var(--secondary-color);
      transform: translateY(-2px);
    }

    /* --------------------------------
       FILES/USERS LIST
    -------------------------------- */
    .list {
      margin-top: 1rem;
      list-style: none;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 4px;
    }
    .list li {
      padding: 0.5rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .list li:last-child {
      border-bottom: none;
    }
    .list::-webkit-scrollbar {
      width: 8px;
    }
    .list::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
    }
    .list::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 4px;
    }

    /* --------------------------------
       MESSAGES
    -------------------------------- */
    .message {
      text-align: center;
      margin-top: 1rem;
      font-weight: 500;
    }
    .message.error {
      color: var(--error-color);
    }
    .message.success {
      color: var(--success-color);
    }

    /* --------------------------------
       LOGOUT CARD
    -------------------------------- */
    .logout-card {
      background: var(--card-bg);
      padding: 1rem;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      margin-top: 1.5rem;
    }
    .logout-card button {
      width: 100%;
      background: linear-gradient(45deg, #e74c3c, #c0392b);
      transition: background 0.3s ease;
    }
    .logout-card button:hover {
      background: linear-gradient(45deg, #c0392b, #e74c3c);
    }

    /* --------------------------------
       ANIMATIONS & MEDIA QUERIES
    -------------------------------- */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @media (max-width: 768px) {
      .sidebar {
        position: relative;
        width: 100%;
        height: auto;
        box-shadow: none;
      }
      header {
        left: 0;
      }
      main {
        margin-left: 0;
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Sidebar Navigation -->
  <nav class="sidebar">
    <ul>
      <li><a href="#" class="active"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
      <li><a href="#systemOverviewCard"><i class="fas fa-chart-line"></i> System Overview</a></li>
      <li><a href="#uploadCard"><i class="fas fa-upload"></i> Upload File</a></li>
      <li><a href="#addUserCard"><i class="fas fa-user-plus"></i> Add User</a></li>
      <li><a href="#updateUserCard"><i class="fas fa-edit"></i> Update User</a></li>
      <li><a href="#deleteUserCard"><i class="fas fa-user-minus"></i> Delete User</a></li>
      <li><a href="#assignAdminCard"><i class="fas fa-user-shield"></i> Assign Admin</a></li>
      <li><a href="#filesCard"><i class="fas fa-file"></i> Files</a></li>
      <li><a href="#usersCard"><i class="fas fa-users"></i> Users</a></li>
      <li><a href="#resetPasswordCard"><i class="fas fa-key"></i> Reset Password</a></li>
      <li><a href="#"><i class="fas fa-cog"></i> Settings</a></li>
    </ul>
  </nav>

  <!-- Header -->
  <header>
    <div class="header-title">Admin Dashboard</div>
  </header>

  <!-- Main Content -->
  <main>
    <div class="container">
      <div class="grid">
        <!-- System Overview Card -->
        <div class="card" id="systemOverviewCard">
          <h3><i class="fas fa-chart-line"></i> System Overview</h3>
          <button id="refreshSystemStatusButton">Refresh System Status</button>
          <div id="systemStatus" style="margin-top: 1rem;">
            <!-- Placeholder values; implement your own endpoint for real data -->
            <p>System Health: <span id="systemHealth">N/A</span></p>
            <p>Online Users: <span id="onlineUsersCount">0</span></p>
          </div>
        </div>

        <!-- Upload File Card -->
        <div class="card" id="uploadCard">
          <h3><i class="fas fa-upload"></i> Upload File</h3>
          <form id="uploadForm">
            <input type="file" id="uploadFile" required>
            <button type="submit">Upload</button>
          </form>
        </div>

        <!-- Add User Card -->
        <div class="card" id="addUserCard">
          <h3><i class="fas fa-user-plus"></i> Add User</h3>
          <form id="addUserForm">
            <input type="text" id="addUsername" placeholder="Username" required>
            <input type="password" id="addPassword" placeholder="Password" required>
            <button type="submit">Add User</button>
          </form>
        </div>

        <!-- Update User Card -->
        <div class="card" id="updateUserCard">
          <h3><i class="fas fa-edit"></i> Update User</h3>
          <form id="updateUserForm">
            <input type="text" id="oldUsername" placeholder="Old Username" required>
            <input type="text" id="newUsername" placeholder="New Username" required>
            <input type="password" id="newPassword" placeholder="New Password" required>
            <button type="submit">Update User</button>
          </form>
        </div>

        <!-- Delete User Card -->
        <div class="card" id="deleteUserCard">
          <h3><i class="fas fa-user-minus"></i> Delete User</h3>
          <form id="deleteUserForm">
            <input type="text" id="deleteUsername" placeholder="Username" required>
            <button type="submit">Delete User</button>
          </form>
        </div>

        <!-- Assign Admin Card -->
        <div class="card" id="assignAdminCard">
          <h3><i class="fas fa-user-shield"></i> Assign Admin</h3>
          <form id="assignAdminForm">
            <input type="text" id="assignUsername" placeholder="Username" required>
            <button type="submit">Promote to Admin</button>
          </form>
        </div>

        <!-- Files List Card -->
        <div class="card" id="filesCard">
          <h3><i class="fas fa-file"></i> Files</h3>
          <button id="getFilesButton">Refresh File List</button>
          <ul id="filesList" class="list"></ul>
        </div>

        <!-- Users List Card -->
        <div class="card" id="usersCard">
          <h3><i class="fas fa-users"></i> Users</h3>
          <button id="getUsersButton">Refresh Users List</button>
          <ul id="usersList" class="list"></ul>
        </div>

        <!-- Reset Password Card -->
        <div class="card" id="resetPasswordCard">
          <h3><i class="fas fa-key"></i> Reset Password</h3>
          <form id="resetPasswordForm">
            <input type="password" id="newAdminPassword" placeholder="New Admin Password" required>
            <button type="submit">Reset Password</button>
          </form>
        </div>
      </div>

      <!-- Logout Card -->
      <div class="logout-card">
        <button id="logoutButton">Logout</button>
      </div>

      <!-- Global Dashboard Result/Status -->
      <div id="dashboardResult" class="message"></div>
    </div>
  </main>

  <script>
    const dashboardResultDiv = document.getElementById('dashboardResult');

    // Helper function to display messages
    function displayMessage(message, type = 'success') {
      dashboardResultDiv.textContent = message;
      dashboardResultDiv.className = "message " + type;
    }

    // ========== System Overview (Placeholder) ==========
    // If you have an actual endpoint (e.g. /system-health), replace below
    document.getElementById('refreshSystemStatusButton').addEventListener('click', async () => {
      try {
        // Example fetch to a hypothetical endpoint
        const response = await fetch('https://localhost/system-health', {
          credentials: 'include'
        });
        const data = await response.json();
        if (!response.ok) {
          displayMessage("Error fetching system status: " + (data.message || response.statusText), "error");
        } else {
          document.getElementById('systemHealth').textContent = data.health || "OK";
          document.getElementById('onlineUsersCount').textContent = data.online_users || 0;
          displayMessage("System status refreshed!");
        }
      } catch (error) {
        displayMessage("Error fetching system status: " + error, "error");
      }
    });

    // ========== File Upload ==========
    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const fileInput = document.getElementById('uploadFile');
      const file = fileInput.files[0];
      if (!file) {
        displayMessage("Please select a file to upload.", "error");
        return;
      }
      const formData = new FormData();
      formData.append('file', file);
      try {
        const response = await fetch('https://localhost/upload', {
          method: 'POST',
          credentials: 'include',
          body: formData
        });
        const data = await response.json();
        if (!response.ok) {
          displayMessage("Upload Error: " + (data.message || response.statusText), "error");
        } else {
          displayMessage(data.message || "File uploaded successfully!");
        }
      } catch (error) {
        displayMessage("Upload Error: " + error, "error");
      }
    });

    // ========== Add User ==========
    document.getElementById('addUserForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const username = document.getElementById('addUsername').value.trim();
      const password = document.getElementById('addPassword').value.trim();
      try {
        const response = await fetch('https://localhost/add-user', {
          method: 'POST',
          credentials: 'include',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        const data = await response.json();
        if (!response.ok) {
          displayMessage("Add User Error: " + (data.message || response.statusText), "error");
        } else {
          displayMessage(data.message || "User added successfully!");
        }
      } catch (error) {
        displayMessage("Add User Error: " + error, "error");
      }
    });

    // ========== Update User ==========
    document.getElementById('updateUserForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const old_username = document.getElementById('oldUsername').value.trim();
      const new_username = document.getElementById('newUsername').value.trim();
      const new_password = document.getElementById('newPassword').value.trim();
      try {
        const response = await fetch('https://localhost/update-user', {
          method: 'PUT',
          credentials: 'include',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ old_username, new_username, new_password })
        });
        const data = await response.json();
        if (!response.ok) {
          displayMessage("Update User Error: " + (data.message || response.statusText), "error");
        } else {
          displayMessage(data.message || "User updated successfully!");
        }
      } catch (error) {
        displayMessage("Update User Error: " + error, "error");
      }
    });

    // ========== Delete User ==========
    document.getElementById('deleteUserForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const username = document.getElementById('deleteUsername').value.trim();
      try {
        const response = await fetch('https://localhost/delete-user', {
          method: 'DELETE',
          credentials: 'include',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username })
        });
        const data = await response.json();
        if (!response.ok) {
          displayMessage("Delete User Error: " + (data.message || response.statusText), "error");
        } else {
          displayMessage(data.message || "User deleted successfully!");
        }
      } catch (error) {
        displayMessage("Delete User Error: " + error, "error");
      }
    });

    // ========== Assign Admin ==========
    document.getElementById('assignAdminForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const username = document.getElementById('assignUsername').value.trim();
      try {
        const response = await fetch('https://localhost/assign-admin', {
          method: 'POST',
          credentials: 'include',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username })
        });
        const data = await response.json();
        if (!response.ok) {
          displayMessage("Assign Admin Error: " + (data.message || response.statusText), "error");
        } else {
          displayMessage(data.message || "User promoted to admin successfully!");
        }
      } catch (error) {
        displayMessage("Assign Admin Error: " + error, "error");
      }
    });

    // ========== Refresh Files List ==========
    document.getElementById('getFilesButton').addEventListener('click', async () => {
      try {
        const response = await fetch('https://localhost/files', {
          credentials: 'include'
        });
        const files = await response.json();
        if (!response.ok) {
          displayMessage("Error fetching files: " + (files.message || response.statusText), "error");
        } else {
          const filesList = document.getElementById('filesList');
          filesList.innerHTML = '';
          files.forEach(file => {
            const li = document.createElement('li');
            li.textContent = `${file.file_name} (Uploader: ${file.uploader})`;
            filesList.appendChild(li);
          });
          displayMessage("Files fetched successfully!");
        }
      } catch (error) {
        displayMessage("Error fetching files: " + error, "error");
      }
    });

    // ========== Refresh Users List ==========
    document.getElementById('getUsersButton').addEventListener('click', async () => {
      try {
        const response = await fetch('https://localhost/users', {
          credentials: 'include'
        });
        const users = await response.json();
        if (!response.ok) {
          displayMessage("Error fetching users: " + (users.message || response.statusText), "error");
        } else {
          const usersList = document.getElementById('usersList');
          usersList.innerHTML = '';
          users.forEach(user => {
            const li = document.createElement('li');
            li.textContent = user;
            usersList.appendChild(li);
          });
          displayMessage("Users fetched successfully!");
        }
      } catch (error) {
        displayMessage("Error fetching users: " + error, "error");
      }
    });

    // ========== Reset Password ==========
    document.getElementById('resetPasswordForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const new_password = document.getElementById('newAdminPassword').value.trim();
      try {
        const response = await fetch('https://localhost/forgot-password', {
          method: 'POST',
          credentials: 'include',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ new_password })
        });
        const data = await response.json();
        if (!response.ok) {
          displayMessage("Reset Password Error: " + (data.message || response.statusText), "error");
        } else {
          displayMessage(data.message || "Password reset successfully!");
        }
      } catch (error) {
        displayMessage("Reset Password Error: " + error, "error");
      }
    });

    // ========== Logout ==========
    document.getElementById('logoutButton').addEventListener('click', async () => {
      try {
        const response = await fetch('https://localhost/logout', {
          method: 'POST',
          credentials: 'include'
        });
        const data = await response.json();
        if (!response.ok) {
          displayMessage("Logout Error: " + (data.message || response.statusText), "error");
        } else {
          displayMessage(data.message || "Logged out successfully!");
          setTimeout(() => {
            window.location.href = 'login.html';
          }, 1000);
        }
      } catch (error) {
        displayMessage("Logout Error: " + error, "error");
      }
    });
  </script>
</body>
</html>
